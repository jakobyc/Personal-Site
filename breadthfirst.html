<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/master.css"/>
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/algorithms.css" />
    <link rel="icon" href="content/favicon.png" type="image/x-icon">
    <title>Breadth-first Visualization</title>
</head>
<body class="theme-background">
    <!--Nav bar -->
    <nav></nav>

    <!-- Content -->
    <br />
    <div class="container">
        <div style="color: white;">
            <h2>Breadth-first Visualization</h2>
            <hr/>
            <div id="grid-controls">
                <h3>Controls:</h3>
                <ul>
                    <li>Hold Left Click + Drag = Paint walls</li>
                    <li>Left Click = Set endpoint</li>
                    <li>Left Ctrl + Drag = Remove walls</li>
                </ul>
            </div>
            <div class="row">
                <div class="col-sm-2">
                    <label>Rows:</label>
                    <input id="rows" class="form-control" value="20">
                </div>
                <div class="col-sm-2">
                    <label>Columns:</label>
                    <input id="columns" class="form-control" value="25">
                </div>
                <div class="col-sm-2">
                    <label>Speed:</label>
                    <input id="speed" type="range" value="60">
                </div>
                <div class="col-sm-offset-5 col-sm-1">
                    <label>&nbsp;</label>
                    <br/>
                    <div style="display: inline;"> 
                            <span id="clear-grid" class="fa fa-trash grid-icon"></span>
                            <a href="https://en.wikipedia.org/wiki/Breadth-first_search" target="_blank" class="fa fa-question grid-icon"></a>
                    </div>
                </div>
            </div>
        </div>

        <br/>
        <div class="not-selectable">
            <table id="grid" class="table table-bordered" style="text-align: center;">
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <footer></footer>
</body>
</html>

<script src="js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="js/bootstrap.js" type="text/javascript"></script>
<script src="js/layout.js" type="text/javascript"></script>
<script src="js/shared.js" type="text/javascript"></script>
<script src="js/algorithms.js" type="text/javascript"></script>

<script>
    $(document).ready(function()
    {
        var layout = new Layout();
        layout.load(function() { layout.setActive('#navHome'); });

        var graph = new Graph();
        createGrid(graph);
        $('#rows').change(function()
        {
            createGrid(graph);
        });

        $('#columns').change(function()
        {
            createGrid(graph);
        });

        $('#clear-grid').click(function()
        {
            createGrid(graph);
        });

        var algorithm = new BreadthFirst();
        var iteration = 1,  
            // Used to control the speed at which the iterations are displayed:
            renderIter = 0;
        algorithm.onNodeComplete = function(node)
        {
            var speed = $('#speed').val();

            renderIter = renderIter + 1;
            setTimeout(function()
            {
                var htmlNode = $('.node').eq(node.id - 1);
                htmlNode.addClass('node-traversed');
                htmlNode.text(iteration);
                iteration = iteration + 1;
            }, ((100 - speed) * renderIter));

        };
        algorithm.onCompletion = function(traversed)
        {
            //console.log(traversed);
        };
        algorithm.beforeStart = function()
        {
            // Reset iteration on execution of algorithm:
            iteration = 1;
            renderIter = 0;
        }

        // Modify state for painting walls:
        var painting = false;
        var removing = false;
        $(document).mousedown(function(e)
        {
            painting = true;
        })

        $(document).mouseup(function(e)
        {
            painting = false;
        })

        $(document).keydown(function(e)
        {
            // If left-ctrl is held, enable removing state:
            if (e.keyCode == 17 || e.which == 17)
            {
                removing = true;
            }
            else
            {
                removing = false;
            }
        });

        $(document).keyup(function(e)
        {
            removing = false;
        });

        function createGrid(graph)
        {
            var rows = $('#rows').val();
            var columns = $('#columns').val();

            if (rows > 0 && rows <= 25 && columns > 0 && columns <= 25)
            {
                // Create graph based off input for rows/columns:
                var grid = graph.createGridGraph(parseInt(columns), parseInt(rows));

                // Create table to match the graph:
                var table = $('#grid');
                var tbody = table.find('tbody');
                // Clear tbody:
                tbody.html('');
                // Id that will be assigned via data attribute (used for quickily querying certain nodes like end nodes):
                var id = 1;
                for (i = 0; i < rows; i++)
                {
                    var tr = $('<tr>');
                    for (c = 0; c < columns; c++)
                    {
                        var td = $('<td>')
                        td.addClass('node');
                        td.attr('data-id', id);

                        tr.append(td);

                        id = id + 1;
                    }
                    table.find('tbody').append(tr);
                }

                // Add listeners to new nodes:
                $('.node').click(function(data)
                {
                    if (!$(this).hasClass('node-wall'))
                    {
                        // Clear traversed nodes and previous ending node:
                        $('.node-traversed').removeClass('node-traversed').text('');
                        $('.node-end').removeClass('node-end').text('');

                        $(this).addClass('node-end');
                        var id = $(this).attr('data-id');

                        // Ids of walls (exclude from algorithm):
                        var ids = [];
                        $.each($('.node-wall'), function()
                        {
                            ids.push($(this).attr('data-id'));
                        });

                        // Execute algorithm:
                        algorithm.execute(grid, 1, id, ids);
                    }
                });

                // Paint walls:
                $('.node').mouseenter(function()
                {
                    if (painting)
                    {
                        $(this).addClass('node-wall')
                    }

                    if (removing)
                    {
                        $(this).removeClass('node-wall')
                    }
                });
            }
        }
    });
</script>

